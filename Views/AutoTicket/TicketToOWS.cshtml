@model MachineMonitoring.Models.ViewModel.AdminVM

@{
	var autoticket = Model.autoTicketModels?.FirstOrDefault();
	var ticket = Model.OwsTicketDetails?.FirstOrDefault();
	var radioDetails = Model.downtimeDetails;
}

@{
	Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AutoTicket | MDM</title>

	<link rel="icon" type="image/png" href="~/img/icon3.png" />
	<link href="~/plugins/fontawesome-free/css/all.min.css" rel="stylesheet" />
	<link href="~/dist/css/adminlte.min.css" rel="stylesheet" />
	<style>
		h5 {
		/* background-color: lightgreen; */
		background-color: indianred;
		padding: 15px;
		border-radius: 15px;
		font-weight: bold;
		}

		.caution-button {
		position: relative;
		font-size: 80px;
		font-weight: 700;
		height: 400px;
		background-color: #d32f2f; /* Bright yellow base */
		color: white;
		border: 8px solid transparent;
		border-image: repeating-linear-gradient( 45deg, black 0 10px, red 10px 20px ) 8; /* 8 = thickness */
		border-radius: 10px;
		cursor: pointer;
		}

		.caution-button:hover {
		background-color: #fff176; /* Slightly lighter on hover */
		}

		.danger-button {
		background-color: #d32f2f;
		color: white;
		font-size: 50px;
		font-weight: 700;
		height: 200px;
		border: none;
		border-radius: 10px;
		box-shadow: 0 0 20px rgba(211, 47, 47, 0.7);
		transition: all 0.2s ease;
		}

		.danger-button:hover {
		background-color: #b71c1c;
		box-shadow: 0 0 30px rgba(211, 47, 47, 1);
		}

		.radio-grid {
			display: grid;
			grid-template-columns: 1fr 1fr; /* Two equal columns */
			gap: 5px 5px; /* row-gap col-gap */
		}
	</style>
</head>
<body>
	<div class="wrapper">
		<!-- Navbar -->
		<nav class="main-header navbar navbar-expand navbar-white navbar-light ml-0">
			<ul class="navbar-nav ml-2">
				<li class="nav-item">
					<a class="navbar-brand">
						<img src="@Url.Content("~/img/icon3.png")" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8;border: solid 1px dimgray; width:4%">
						<span class="brand-text font-weight-strong" style="color:dimgray">Machine Downtime Monitoring</span>
					</a>
				</li>
			</ul>
		</nav>
	</div>


	<div class="container col-sm-11 mt-3">
		<div class="card card-outline">
			<div class="card-header">
				<h3> <i class="fas fa-stopwatch mr-2"></i> Machine Downtime </h3>
			</div>

			@if (ViewBag.Result == "OK")
			{
				<form method="POST" asp-controller="AutoTicket" asp-action="SendTicketToOws">
					<div class="card-body">
						<div class="row">
							<div class="col">
								<!-- Machine Code -->
								<div class="form-group">
									<label for="machineCode">Machine Code</label>
									<input type="text" class="form-control" id="machineCode" name="MachineCode"
										   value="@(autoticket?.MachineCode)" readonly />
								</div>

								<!-- Process -->
								<div class="form-group">
									<label for="Process">Process</label>
									<input type="text" class="form-control" id="Process" name="Process"
										   value="@(autoticket?.Process)" readonly />
								</div>
							</div>
							<div class="col">
								<!-- Plant No -->
								<div class="form-group">
									<label for="PlantNo">Plant No</label>
									<input type="number" class="form-control" id="PlantNo" name="PlantNo"
										   value="@(autoticket?.PlantNo.ToString())" readonly />
								</div>
								
								<!-- Area -->
								<div class="form-group">
									<label for="Area">Area</label>
									<input type="text" class="form-control" id="Area" name="Area"
										   value="@(autoticket?.Area)" readonly />
								</div>
							</div>
						</div>

						<!-- Error Of Details Radio Button -->
						<div class="form-group">
							<label for="detailsOfError">Details of Error</label>

							<div class="radio-grid">
								@foreach (var item in radioDetails)
								{
									<div class="form-check">
										<input type="radio"
											   name="detailsOfError"
											   value="@item.downtimeDetails"
											   id="opt_@item.downtimeDetails"
											   class="form-check-input" />
										<label for="opt_@item.downtimeDetails" class="form-check-label">
											@item.downtimeDetails
										</label>
									</div>
								}
							</div>
							<!-- Others Option -->
							<div class="form-check d-flex align-items-center">
								<input type="radio" name="detailsOfError" value="Others" id="opt_others" class="form-check-input" />
								<label for="opt_others" class="form-check-label mt-1">Others</label>
								<input type="text" name="OtherDetails" id="OtherDetails"
									   class="form-control ml-3"
									   placeholder="Please specify..."
									   style="display:none; width: 100%;" />
							</div>
						</div>
					</div>

					<!-- Call Button -->
					<div class="card-footer d-flex justify-content-end">
						<button type="submit" id="saveButton" class="caution-button w-100">
							Call  <i class="fas fa-bell ml-2"></i> Maintenance
						</button>
					</div>
				</form>
			}
			else
			{
				<div class="card-body">
					<h5 class="mb-3"> <i class="fas fa-times mr-2"></i> @ViewBag.Message</h5>

					<div>

						<h4><strong>Machine Status:</strong> <i>@(ticket.ticket_status)</i></h4>

						<div class="row">
							<div class="col">
								<p><strong>Reported last:</strong> <i>@(ticket.mc_error_buyoff_repair_date)</i></p>
								<p><strong>Control No:</strong>  <i>@(ticket.controlno)</i></p>
								<p><strong>Process/Area:</strong> <i>@(ticket.process) - @(ticket.area)</i></p>

								@if (ticket.me_support != null)
								{
									<p><strong>Maintenance PIC:</strong>  <i>@(ticket.me_support)</i></p>
									<p><strong>Error Details:</strong>  <i>@(ticket.errorcode) - @(ticket.errorname)</i></p>
								}
							</div>
						</div>

					</div>

				</div>
			}

		</div>
	</div>

	<script src="~/plugins/jquery/jquery.min.js"></script>
	<script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="~/dist/js/adminlte.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const radios = document.querySelectorAll('input[name="detailsOfError"]');
			const otherInput = document.getElementById("OtherDetails");

			radios.forEach(radio => {
				radio.addEventListener("change", function () {
					if (this.value === "Others") {
						otherInput.style.display = "block";
					} else {
						otherInput.style.display = "none";
						otherInput.value = ""; // clear text when hidden
					}
				});
			});
		});
	</script>

</body>
</html>
